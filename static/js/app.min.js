class StandardGPTApp{constructor(){this.currentRequest=null;this.isLoading=!1;this.debugVisible=!0;this.elements={questionInput:document.getElementById("questionInput"),submitBtn:document.getElementById("submitBtn"),clearBtn:document.getElementById("clearBtn"),loadingContainer:document.getElementById("loadingContainer"),resultsContainer:document.getElementById("resultsContainer"),answerContent:document.getElementById("answerContent"),debugContent:document.getElementById("debugContent"),debugToggle:document.getElementById("debugToggle"),processingTime:document.getElementById("processingTime"),securityStatus:document.getElementById("securityStatus"),examplesContainer:document.getElementById("examplesContainer"),cancelBtn:document.getElementById("cancelBtn")};this.init()}init(){this.setupEventListeners();this.loadExamples();this.setupKeyboardShortcuts();this.setupAccessibility();this.focusInput();console.log("StandardGPT initialized successfully")}setupEventListeners(){this.elements.submitBtn.addEventListener("click",()=>this.submitQuestion());this.elements.clearBtn.addEventListener("click",()=>this.clearAll());this.elements.questionInput.addEventListener("keydown",e=>{"Enter"===e.key&&e.ctrlKey&&(e.preventDefault(),this.submitQuestion())});this.elements.questionInput.addEventListener("input",()=>this.validateInput());this.elements.debugToggle.addEventListener("click",()=>this.toggleDebug());this.elements.cancelBtn.addEventListener("click",()=>this.cancelRequest());this.elements.questionInput.addEventListener("input",this.autoResizeTextarea.bind(this))}setupKeyboardShortcuts(){document.addEventListener("keydown",e=>{e.ctrlKey&&"k"===e.key&&(e.preventDefault(),this.focusInput());"Escape"===e.key&&(this.isLoading?this.cancelRequest():this.clearAll())})}setupAccessibility(){this.elements.loadingContainer.setAttribute("aria-live","polite");this.elements.resultsContainer.setAttribute("aria-live","polite")}loadExamples(){const e=[{question:"Hva sier NS-EN ISO 14155 om temperaturkrav?",category:"Temperatur"},{question:"Hvilke sikkerhetskrav gjelder for elektriske installasjoner?",category:"Sikkerhet"},{question:"Hva er kravene til brannsikkerhet i bygninger?",category:"Brann"},{question:"Hvilke standarder gjelder for vannkvalitet?",category:"Vann"},{question:"Hva sier standardene om st√∏yniv√• i arbeidsomr√•der?",category:"St√∏y"},{question:"Hvilke krav stilles til ventilasjon i kontorbygg?",category:"Ventilasjon"}];this.elements.examplesContainer.innerHTML=e.map(e=>`<div class="example-card" onclick="app.useExample('${e.question.replace(/'/g,"\\'")}')"><div class="example-category">${e.category}</div><div class="example-text">${e.question}</div></div>`).join("")}useExample(e){this.elements.questionInput.value=e;this.validateInput();this.focusInput();this.elements.questionInput.scrollIntoView({behavior:"smooth",block:"center"})}validateInput(){const e=this.elements.questionInput.value.trim(),t=e.length>=3&&e.length<=1e3;this.elements.submitBtn.disabled=!t||this.isLoading;const n=document.querySelector(".help-text");if(n){const t=1e3-e.length;n.textContent=`${e.length}/1000 tegn (${t} igjen)`;t<50?n.classList.add("warning"):n.classList.remove("warning")}return t}autoResizeTextarea(){const e=this.elements.questionInput;e.style.height="auto";e.style.height=Math.min(e.scrollHeight,200)+"px"}async submitQuestion(){if(!this.validateInput()||this.isLoading)return;const e=this.elements.questionInput.value.trim();try{this.setLoadingState(!0);this.hideResults();const t=Date.now(),n=new AbortController;this.currentRequest=n;const s=await fetch("/api/query",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:e}),signal:n.signal});if(!s.ok){const e=await s.json();throw new Error(e.error||`HTTP ${s.status}`)}const i=await s.json(),o=Date.now()-t;this.displayResults(i,o)}catch(e){"AbortError"!==e.name&&(this.displayError(e.message),console.error("Error submitting question:",e))}finally{this.setLoadingState(!1);this.currentRequest=null}}cancelRequest(){this.currentRequest&&(this.currentRequest.abort(),this.currentRequest=null);this.setLoadingState(!1)}setLoadingState(e){this.isLoading=e;this.elements.submitBtn.disabled=e;this.elements.questionInput.disabled=e;e?(this.elements.loadingContainer.style.display="block",this.elements.submitBtn.innerHTML="‚è≥ S√∏ker..."):(this.elements.loadingContainer.style.display="none",this.elements.submitBtn.innerHTML="üöÄ Sp√∏r StandardGPT");this.validateInput()}displayResults(e,t){this.elements.answerContent.innerHTML=this.formatAnswer(e.answer);this.elements.debugContent.textContent=JSON.stringify(e.debug,null,2);this.elements.processingTime.textContent=`${t}ms`;this.elements.securityStatus.innerHTML=e.security_info?'<span class="status-secure">‚úÖ Sikker</span>':'<span class="status-warning">‚ö†Ô∏è Ukjent</span>';this.showResults();this.elements.resultsContainer.scrollIntoView({behavior:"smooth",block:"start"});this.announceToScreenReader("S√∏keresultater er klare")}formatAnswer(e){if(!e)return'<p class="no-answer">Ingen svar funnet.</p>';let t=e.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`(.*?)`/g,"<code>$1</code>").replace(/\n\n/g,"</p><p>").replace(/\n/g,"<br>");return`<p>${t}</p>`}displayError(e){this.elements.answerContent.innerHTML=`<div class="error-message"><h4>‚ùå Feil oppstod</h4><p>${e}</p><button class="btn btn-secondary mt-2" onclick="app.focusInput()">Pr√∏v igjen</button></div>`;this.elements.debugContent.textContent=`Error: ${e}`;this.showResults();this.announceToScreenReader(`Feil: ${e}`)}showResults(){this.elements.resultsContainer.style.display="block";this.updateDebugVisibility()}hideResults(){this.elements.resultsContainer.style.display="none"}toggleDebug(){this.debugVisible=!this.debugVisible;this.updateDebugVisibility()}updateDebugVisibility(){const e=document.querySelector(".debug-card");e&&(e.style.display=this.debugVisible?"block":"none");this.elements.debugToggle.textContent=this.debugVisible?"üîç Skjul Debug":"üîç Vis Debug"}clearAll(){this.elements.questionInput.value="";this.hideResults();this.validateInput();this.focusInput();this.elements.questionInput.style.height="auto"}focusInput(){this.elements.questionInput.focus();const e=this.elements.questionInput.value.length;this.elements.questionInput.setSelectionRange(e,e)}announceToScreenReader(e){const t=document.createElement("div");t.setAttribute("aria-live","polite");t.setAttribute("aria-atomic","true");t.className="sr-only";t.textContent=e;document.body.appendChild(t);setTimeout(()=>{document.body.removeChild(t)},1e3)}}document.addEventListener("DOMContentLoaded",()=>{window.app=new StandardGPTApp});"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/static/js/sw.js").then(e=>{console.log("SW registered: ",e)}).catch(e=>{console.log("SW registration failed: ",e)})});"undefined"!=typeof module&&module.exports&&(module.exports=StandardGPTApp); 